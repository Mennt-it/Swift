@inherits Dynamicweb.Rendering.RazorTemplateBase<Dynamicweb.Rendering.RazorTemplateModel<Dynamicweb.Rendering.Template>>
@using Dynamicweb
@using System.IO

@{ 
	string lang = Pageview.Area.CultureInfo.TwoLetterISOLanguageName;

	string paddingTop = "padding-top: 16px;";
	string paddingBottom = "padding-bottom:16px;";
	string paddingLeft = "padding-left: 16px;";
	string paddingRight = "padding-right:16px;";

	string borderTop = "border-top: 1px solid;";
	string borderBottom = "border-bottom: 1px solid;";
	string borderLeft = "border-left: 1px solid;";
	string borderRight = "border-right: 1px solid;";

	string textPrice = "font-variant-numeric: tabular-nums; white-space: nowrap;";

	string verticalAlignTop = "vertical-align: top;";

	string textRight = "text-align: right;";
	string textLeft= "text-align: left;";

	string fontBold = "font-weight: bold;";
	string fontNormal = "font-weight: normal;";
	string fontSizeLarge = "font-size: 20px; font-size: 1.25rem; font-size: max(16px, 1.25rem);";

}


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if IE]>
	<html xmlns="http://www.w3.org/1999/xhtml" class="ie" lang="@lang">
<![endif]-->
<!--[if !IE]><!-->
<html style="margin: 0;padding: 0;" xmlns="http://www.w3.org/1999/xhtml" lang="@lang">
<!--<![endif]-->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title></title>
	<!--[if !mso]><!-->
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><!--<![endif]-->
	<meta name="viewport" content="width=device-width">
	<meta name="x-apple-disable-message-reformatting">
	<meta name="robots" content="noindex,nofollow">
	<style>
		@*table, th, td {
			border: 1px solid;
			white-space: nowrap;
		}

		th, td {
			border-left: none;
			border-right: none;
		}

		th {
			padding-left: 16px;
			padding-right:16px;
			padding-top: 8px;
			text-align: left;
		}
		
		td {
			padding-left: 16px;
			padding-right: 16px;
			padding-bottom: 8px;
		}*@
	</style>
	<meta property="og:title" content="">
</head>
<!--[if mso]>
	<body class="mso">
<![endif]-->
<!--[if !mso]><!-->

<body style="-webkit-text-size-adjust: 100%;">
	<!--<![endif]-->
	<table cellpadding="0" cellspacing="0" role="presentation" style="border-collapse: collapse; table-layout: fixed; min-width: 320px; width: 100%; max-width: 560px;">
		<tr>
			<th style="@(textLeft)">
				<h1>@Translate("Thank you for your order")</h1>
			</th>
		</tr>
		<tr>
			<td style="@paddingBottom">@Translate("We are processing your order now, here are the details")</td>
		</tr>
	</table>
	
	<table cellpadding="0" cellspacing="0" role="presentation" style="border-collapse: collapse;table-layout: fixed; min-width: 320px; width: 100%; max-width: 560px;">
		@if (!string.IsNullOrEmpty(GetString("Ecom:Order.ID"))) {
			<tr>
				<th style="@(fontNormal)@(textLeft)@(borderLeft)@(borderRight)@(borderTop)@(paddingTop)@(paddingLeft)@(paddingRight)">@Translate("Order number")</th>
			</tr>
			<tr>
				<td style="@(textLeft)@(borderLeft)@(borderRight)@(borderBottom)@(paddingBottom)@(paddingLeft)@(paddingRight)">@GetString("Ecom:Order.ID")</td>
			</tr>
		}

		@if (!string.IsNullOrEmpty(GetString("Ecom:Order.Completed"))) {
			<tr>
				<th style="@(fontNormal)@(textLeft)@(borderLeft)@(borderRight)@(borderTop)@(paddingTop)@(paddingLeft)@(paddingRight)">@Translate("Order date")</th>
			</tr>
			<tr>
				<td style="@(textLeft)@(borderLeft)@(borderRight)@(borderBottom)@(paddingBottom)@(paddingLeft)@(paddingRight)">@GetString("Ecom:Order.Completed")</td>
			</tr>
		}

		<tr>
			<th style="@(fontNormal)@(textLeft)@(borderLeft)@(borderRight)@(borderTop)@(paddingTop)@(paddingLeft)@(paddingRight)">@Translate("Contact")</th>
		</tr>
		@if (!string.IsNullOrEmpty(@GetString("Ecom:Order.Delivery.Email")))
		{
			<tr>
				<td style="@(textLeft)@(borderLeft)@(borderRight)@(borderBottom)@(paddingBottom)@(paddingLeft)@(paddingRight)">
					<span>@GetString("Ecom:Order.Delivery.Email"), </span>

					@if (!string.IsNullOrEmpty(@GetString("Ecom:Order.Delivery.Phone")))
					{
						<span>@GetString("Ecom:Order.Delivery.Phone")</span>
					}
				</td>
			</tr>
		}

		<tr>
			<th style="@(fontNormal)@(textLeft)@(borderLeft)@(borderRight)@(borderTop)@(paddingTop)@(paddingLeft)@(paddingRight)">@Translate("Delivery address")</th>
		</tr>

		<tr>
			<td style="@(textLeft)@(borderLeft)@(borderRight)@(borderBottom)@(paddingBottom)@(paddingLeft)@(paddingRight)">
				@if (!string.IsNullOrEmpty(GetString("Ecom:Order.Delivery.Name")))
				{
				<span>@GetString("Ecom:Order.Delivery.Name"),</span>
				}
				@if (!string.IsNullOrEmpty(GetString("Ecom:Order.Delivery.Address")))
				{
				<span>@GetString("Ecom:Order.Delivery.Address"), </span>
				}
				@if (!string.IsNullOrEmpty(GetString("Ecom:Order.Delivery.Zip")))
				{
				<span>@GetString("Ecom:Order.Delivery.Zip")</span>
				}
				@if (!string.IsNullOrEmpty(GetString("Ecom:Order.Delivery.City")))
				{
				<span>@GetString("Ecom:Order.Delivery.City")</span>
				}
			</td>
		</tr>

		<tr>
			<th style="@(fontNormal)@(textLeft)@(borderLeft)@(borderRight)@(borderTop)@(paddingTop)@(paddingLeft)@(paddingRight)">@Translate("Billing address")</th>
		</tr>
		<tr>
			<td style="@(textLeft)@(borderLeft)@(borderRight)@(borderBottom)@(paddingBottom)@(paddingLeft)@(paddingRight)">
				@if (!string.IsNullOrEmpty(GetString("Ecom:Order.Customer.Name")))
				{
					<span>@GetString("Ecom:Order.Customer.Name"),</span>
				}
				@if (!string.IsNullOrEmpty(GetString("Ecom:Order.Customer.Address")))
				{
					<span>@GetString("Ecom:Order.Customer.Address"),</span>
				}
				@if (!string.IsNullOrEmpty(GetString("Ecom:Order.Customer.Zip")))
				{
					<span>@GetString("Ecom:Order.Customer.Zip")</span>
				}
				@if (!string.IsNullOrEmpty(GetString("Ecom:Order.Customer.City")))
				{
					<span>@GetString("Ecom:Order.Customer.City")</span>
				}
			</td>
		</tr>
			
		@if (!string.IsNullOrEmpty(GetString("Ecom:Order.ShippingMethod")))
		{
			<tr>
				<th style="@(fontNormal)@(textLeft)@(borderLeft)@(borderRight)@(borderTop)@(paddingTop)@(paddingLeft)@(paddingRight)">@Translate("Delivery method")</th>
			</tr>
			<tr>
				<td style="@(textLeft)@(borderLeft)@(borderRight)@(borderBottom)@(paddingBottom)@(paddingLeft)@(paddingRight)">@GetString("Ecom:Order.ShippingMethod")</td>
			</tr>
		}

		@if (!string.IsNullOrEmpty(GetString("Ecom:Order.PaymentMethod")))
		{
			<tr>
				<th style="@(fontNormal)@(textLeft)@(borderLeft)@(borderRight)@(borderTop)@(paddingTop)@(paddingLeft)@(paddingRight)">@Translate("Payment method")</th>
			</tr>
			<tr>
				<td style="@(textLeft)@(borderLeft)@(borderRight)@(borderBottom)@(paddingBottom)@(paddingLeft)@(paddingRight)">@GetString("Ecom:Order.PaymentMethod")</td>
			</tr>
		}
	</table>

	<table cellpadding="0" cellspacing="0" role="presentation" style="border-collapse: collapse; table-layout: fixed; min-width: 320px; width: 100%; max-width: 560px; margin-top: 32px; @(borderTop)@(borderBottom)@(borderLeft)@(borderRight)">
		
		@foreach (LoopItem orderline in GetLoop("OrderLines"))
		{
			string name = orderline.GetString("Ecom:Order:OrderLine.ProductName");
			string image = "/Admin/Public/GetImage.ashx?width=" + 120 + "&height=" + 120 + "&crop=5&fillcanvas=true&Background=ffffff&image=" + orderline.GetString("Ecom:Product.PrimaryImage") + "&Format=WebP&Quality=100";
			string removeFromBasketLink = orderline.GetString("Ecom:Order:OrderLine.DeleteLink");
			string priceTotalWithDiscounts = orderline.GetString("Ecom:Order:OrderLine.TotalPriceWithProductDiscounts.PriceFormatted");
			string priceBefore = orderline.GetString("Ecom:Product.InformativePrice.PriceFormatted");
			string unitPrice = orderline.GetString("Ecom:Order:OrderLine.UnitPrice.PriceFormatted");
			string discountPrice = orderline.GetString("Ecom:Product.Discount.Price.PriceFormatted");
			string discountTotal = orderline.GetString("Ecom:Order:OrderLine.TotalDiscount.PriceFormatted");
			string variantText = orderline.GetString("Ecom:Order:OrderLine.ProductVariantText");
			var orderlineId = orderline.GetValue("Ecom:Order:OrderLine.Id");
			var quantity = orderline.GetDouble("Ecom:Order:OrderLine.Quantity");
			string primaryGroupId = orderline.GetString("Ecom:Order:OrderLine.PrimaryOrDefaultGroupId");
			string productId = orderline.GetString("Ecom:Order:OrderLine.ProductID");
			string variantId = orderline.GetString("Ecom:Order:OrderLine.ProductVariantID");

			string link = "#";
			string productDetailPageId = Pageview.CurrentParagraph.Item["ProductPageLink"] != null ? Pageview.CurrentParagraph.Item["ProductPageLink"].ToString() : "";
			productDetailPageId = productDetailPageId != "" ? productDetailPageId : GetPageIdByNavigationTag("ProductDetailPage").ToString();
			link = "/Default.aspx?ID=" + productDetailPageId + "&amp;ProductID" + productId;

			if (!string.IsNullOrEmpty(variantId))
			{
				link += "&VariantID=" + variantId;
			}

			bool isProduct = orderline.GetBoolean("Ecom:Order:OrderLine.IsProduct");

			if (isProduct)
			{
				<tr>
					<td style="@(verticalAlignTop)@(textLeft)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)">
						@* Image *@
						<a href="@link" title="@name">
							<img src="@image" style="object-fit: contain;" alt="@name">
						</a>
					</td>
					<td style="@(verticalAlignTop)@(textLeft)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)">
						@* Title *@
						<h3 style="@(fontNormal)font-weight:normal;">
							<a href="@link" title="@name">@name</a>
						</h3>
						@* Variants *@
						<p>@variantText</p>
						<p>
							@* Unit price *@
							@if (discountPrice == unitPrice)
							{
								<span style="@(textPrice)">@unitPrice</span> 
							}
							else
							{
								<span style="@(textPrice)">@discountPrice</span>
								<span style="@(textPrice)">@unitPrice</span>}
						</p>
						@* Quantity *@
						<p>@Translate("Quantity"): @quantity</p>
					</td>
					<td style="@(verticalAlignTop)@(textRight)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)">
						@* Total *@
						<span style="@(textPrice)">@priceTotalWithDiscounts</span>
						@if (orderline.GetDouble("Ecom:Order:OrderLine.TotalDiscount.Price.Value") != 0)
						{
						<span style="@(textPrice)">@discountTotal</span>}
					</td>
				</tr>
			}
			else
			{
				<tr>
					<td colspan="2" style="@(textLeft)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)">
						@* Title *@
						<a href="@link" title="@name">@name</a>
					</td>
					<td style="@(textPrice)@(textRight) @(paddingTop) @(paddingBottom) @(paddingLeft) @(paddingRight)">@priceTotalWithDiscounts</td>

					@if (orderline.GetDouble("Ecom:Order:OrderLine.TotalDiscount.Price.Value") != 0)
					{
						<td style="@(textPrice)@(textRight) @(paddingTop) @(paddingBottom) @(paddingLeft) @(paddingRight)">@discountTotal</td>
					}
				</tr>
			}
		}
	</table>

	<table cellpadding="16" cellspacing="0" role="presentation" style="border-collapse: collapse; table-layout: fixed; min-width: 320px; width: 100%; max-width: 560px; @(borderTop)@(borderBottom)@(borderLeft)@(borderRight)">
		<tr>
			@{ 
				string totalPriceWithoutDiscountsFeesAndTaxes = GetString("Ecom:Order.TotalPriceWithoutDiscountsFeesAndTaxes.PriceFormatted");
				string totalPriceWithoutOrderDiscountsAndFees = GetString("Ecom:Order.TotalPriceWithoutOrderDiscountsAndFees.PriceFormatted"); 
			}

			@* Subtotal *@
			<th style="@(textLeft)@(fontBold)">@Translate("Subtotal")</th>
			<td style="@(textRight)">
				@if (totalPriceWithoutDiscountsFeesAndTaxes != totalPriceWithoutOrderDiscountsAndFees)
				{
					<span style="@(textPrice)text-decoration: line-through;">@totalPriceWithoutDiscountsFeesAndTaxes</span>
				}
				<span style="@(textPrice)@(fontBold);">@totalPriceWithoutOrderDiscountsAndFees</span>
			</td>
		</tr>
			@* Discounts (only order discounts) *@
			@foreach (LoopItem orderline in GetLoop("OrderLines"))
			{
				bool isDiscount = orderline.GetBoolean("Ecom:Order:OrderLine.IsDiscount");
				bool isOrderDiscount = orderline.GetInteger("Ecom:Order:OrderLine.Type") == 1;
				if (isDiscount && isOrderDiscount)
				{	
					<tr>
						<th style="@(fontNormal)@(textLeft)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)">@orderline.GetString("Ecom:Order:OrderLine.ProductName")</th>
						<td style="@(textPrice)@(textRight)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)">@orderline.GetString("Ecom:Order:OrderLine.TotalPriceWithProductDiscounts.PriceFormatted")</td>
					</tr>
				}
			}

			@* Shipping *@
			@if (!string.IsNullOrEmpty(GetString("Ecom:Order.ShippingMethodID")))
			{
				if (GetDouble("Ecom:Order.ShippingFee.Price.Value") != 0)
				{
					<tr>
						<th style="@(fontNormal)@(textLeft)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)">@Translate("Delivery")</th>
						<td style="@(textPrice)@(textRight)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)">@GetString("Ecom:Order.ShippingFee.PriceFormatted")</td>
					</tr>
				}
			}

			@* Payment *@
			@if (!string.IsNullOrEmpty(GetString("Ecom:Order.PaymentMethodID")))
			{
				if (GetDouble("Ecom:Order.PaymentFee.Price.Value") != 0)
				{

					<tr>
						<th style="@(fontNormal)@(textLeft)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)@(borderBottom)">@Translate("Payment")</th>
						<td style="@(textPrice)@(textRight)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)@(borderBottom)">@GetString("Ecom:Order.PaymentFee.PriceFormatted")</td>
					</tr>
				}
			}

		<tr>
			<th style="@(textLeft)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)@(fontBold)">@Translate("Total")</th>
			<td style="@(textPrice)@(textRight)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)@(fontBold)@(fontSizeLarge)">@GetString("Ecom:Order.Price.PriceFormatted")</td>
		</tr>

		<tr>
			<th style="@(fontNormal)@(textLeft)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)">@Translate("VAT")</th>
			<td style="@(textPrice)@(textRight)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)">@GetString("Ecom:Order.Price.VATFormatted")</td>
		</tr>

		@if (GetDouble("Ecom:Order.TotalDiscount.Price.Value") != 0)
		{
			<tr>
				<th style="@(fontNormal)@(textLeft)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)">@Translate("Discount")</th>
				<td style="@(textPrice)@(textRight)@(paddingTop)@(paddingBottom)@(paddingLeft)@(paddingRight)">@GetString("Ecom:Order.TotalDiscount.PriceFormatted")</td>
			</tr>
		}
	</table>
</body>

</html>
