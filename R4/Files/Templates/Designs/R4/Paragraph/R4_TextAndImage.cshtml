@inherits Dynamicweb.Rendering.ViewModelTemplate<Dynamicweb.Frontend.ParagraphViewModel>
@using Dynamicweb.Frontend


@{ 
	string layout = Model.Item?.GetList("Layout")?.SelectedValue != null ? Model.Item.GetList("Layout").SelectedValue : "image-top";

	string contentPadding = !string.IsNullOrEmpty(Model.Item.GetString("ContentPadding")) ? Model.Item.GetList("ContentPadding").SelectedValue : "";
	contentPadding = contentPadding == "none" ? "px-0" : contentPadding;
	contentPadding = contentPadding == "small" ? "p-2 p-md-3" : contentPadding;
	contentPadding = contentPadding == "large" ? "p-4 p-md-5" : contentPadding;

	int xPos = Model.Item?.GetFile("Image")?.FocalPositionFromLeft ?? 50;
	int yPos = Model.Item?.GetFile("Image")?.FocalPositionFromTop ?? 50;

	string ratioCssClass = Model.Item?.GetList("ImageAspectRatio")?.SelectedValue != "0" && Model.Item?.GetList("ImageAspectRatio")?.SelectedValue != "" ? "ratio" : "";
	string ratioVariable = Model.Item?.GetList("ImageAspectRatio")?.SelectedValue != "0" && Model.Item?.GetList("ImageAspectRatio")?.SelectedValue != "" ? "style=\"--bs-aspect-ratio: " + Model.Item.GetList("ImageAspectRatio").SelectedValue + "\"" : "";

	string titleFontSize = Model.Item?.GetList("TitleFontSize")?.SelectedValue != null ? Model.Item.GetList("TitleFontSize").SelectedValue : "h3";
	string subtitleFontSize = Model.Item?.GetList("SubtitleFontSize")?.SelectedValue != null ? Model.Item.GetList("SubtitleFontSize").SelectedValue : "fs-5";


	string theme = !string.IsNullOrEmpty(Model.Item.GetString("Theme")) ? Model.Item.GetString("Theme").ToLower() : "";
	if (theme != "theme default" && theme != "")
	{
		theme = String.Concat(theme.Where(c => !Char.IsWhiteSpace(c)));
		theme = theme.Replace("theme", "");
		theme = " theme theme-" + theme;
	} else {
		theme = "";
	}
}

<div class="h-100 position-relative @(theme)">
    @switch (layout) {
        case "image-top":
				@RenderImage()
			<div class="p-3 flex-fill @contentPadding">
				<h3 class="@titleFontSize h3 mb-3">@RenderTitle()</h3>
				<p class="@subtitleFontSize lead mb-3 max-w-75ch">@RenderLead()</p>			
				@RenderText()
				@RenderButton()
			</div>
        break;

        case "title-top":
            <div class="d-flex flex-column h-100">
				@if (!string.IsNullOrEmpty(Model.Item.GetString("Title"))) {
					<div class="p-3 flex-fill @contentPadding">
						<h3 class="@titleFontSize mb-0">@RenderTitle()</h3>
					</div>
				}

				@RenderImage()
				<div class="p-3 flex-fill @contentPadding">
					<p class="@subtitleFontSize lead mb-3 max-w-75ch">@RenderLead()</p>			
					@RenderText()
                    @RenderButton()
                </div>
            </div>
        break;

        case "title-lead-top":
				if (
					!string.IsNullOrEmpty(Model.Item.GetString("Title")) ||
					!string.IsNullOrEmpty(Model.Item.GetString("lead"))
					) {
					<div class="p-3 flex-fill @contentPadding">
						<h3 class="@titleFontSize mb-3">@RenderTitle()</h3>
						<p class="@subtitleFontSize lead mb-0 max-w-75ch">@RenderLead()</p>			
					</div>
				}
				@RenderImage()
			<div class="p-3 flex-fill @contentPadding">
				@RenderText()
				@RenderButton()
			</div>
        break;

        case "text-center":
				@RenderImage()
			<div class="p-3 d-flex flex-column align-items-center text-center flex-fill @contentPadding">
				<h3 class="@titleFontSize mb-3">@RenderTitle()</h3>
				<p class="@subtitleFontSize lead mb-3 max-w-75ch">@RenderLead()</p>			
				@RenderText()
				@RenderButton()
			</div>
        break;
		case "image-bottom":
			<div class="p-3 flex-fill @contentPadding">
				<h3 class="@titleFontSize mb-3">@RenderTitle()</h3>
				<p class="@subtitleFontSize lead mb-3 max-w-75ch">@RenderLead()</p>			
				@RenderText()
				@RenderButton()
			</div>
				@RenderImage()
        break;
    } 
</div>


@helper RenderImage() { 
	if (!string.IsNullOrEmpty(Model.Item.GetString("Image"))) {
		var parms = new Dictionary<string, object>();
		parms.Add("loading", "lazy");
		parms.Add("cssClass", "w-100 h-100 rounded-0 h-100 w-100");
		parms.Add("style", "");
		parms.Add("alt", @Model.Item.GetString("Title"));

		int xPos = Model.Item?.GetFile("Image")?.FocalPositionFromLeft ?? 50;
		int yPos = Model.Item?.GetFile("Image")?.FocalPositionFromTop ?? 50;

		string ratioCssClass = Model.Item?.GetList("ImageAspectRatio")?.SelectedValue != "0" && Model.Item?.GetList("ImageAspectRatio")?.SelectedValue != "" ? "ratio" : "";
		string ratioVariable = Model.Item?.GetList("ImageAspectRatio")?.SelectedValue != "0" && Model.Item?.GetList("ImageAspectRatio")?.SelectedValue != "" ? "style=\"--bs-aspect-ratio: " + Model.Item.GetList("ImageAspectRatio").SelectedValue + "\"" : "";

		<figure class="m-0 @ratioCssClass" @ratioVariable>
			@RenderPartial("Components/Image.cshtml", Model, parms)
		</figure>
    }
}

@helper RenderTitle() { 

    if (!string.IsNullOrEmpty(Model.Item.GetString("Title")) && !Model.Item.GetBoolean("HideTitle"))
    {
        @Model.Item.GetString("Title")
    }
}

@helper RenderLead() {

    if (!string.IsNullOrEmpty(Model.Item.GetString("Lead")))
    {
        @Model.Item.GetString("Lead")
    }
}

@helper RenderText() { 
    if (!string.IsNullOrEmpty(Model.Item.GetString("Text")))
    {
        <div class="max-w-75ch">
			@Model.Item.GetString("Text")
		</div>
    }
}

@helper RenderButton() { 
    if (!string.IsNullOrEmpty(Model.Item.GetString("ButtonLink")) && !string.IsNullOrEmpty(Model.Item.GetString("ButtonLabel")))
    {
		string buttonStyle = !string.IsNullOrEmpty(Model.Item.GetString("ButtonStyle")) ? 
		Model.Item.GetList("ButtonStyle").SelectedValue : "";
		buttonStyle = buttonStyle == "primary" ? " btn-primary" : buttonStyle;
		buttonStyle = buttonStyle == "secondary" ? " btn-secondary" : buttonStyle;

		<a href="@Model.Item.GetString("ButtonLink")" class="btn @buttonStyle stretched-link">@Model.Item.GetString("ButtonLabel")</a>
    } 
	else if (!string.IsNullOrEmpty(Model.Item.GetString("ButtonLink"))) {
		<a href="@Model.Item.GetString("ButtonLink")" class="stretched-link"></a>
	}
}
