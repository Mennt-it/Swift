@using Dynamicweb.Rendering
@using Dynamicweb.Ecommerce.ProductCatalog
@using Dynamicweb.Frontend
@using System.Web

@{ bool isVisualEditor = !string.IsNullOrEmpty(HttpContext.Current.Request.QueryString.Get("VisualEdit")) ? Convert.ToBoolean(HttpContext.Current.Request.QueryString.Get("VisualEdit")) : false;

	ProductViewModel product = new ProductViewModel();

	if (System.Web.HttpContext.Current.Items.Contains("ProductDetails"))
	{
		product = (ProductViewModel)System.Web.HttpContext.Current.Items["ProductDetails"];
	} 
}

<div class="item">
	<div class="d-flex flex-column">
		<div class="mb-4">
			<div class="display-6">@product.Name</div>
		</div>
		<div class="mb-4">
			<div class="fs-4 fw-bold">@product.Price.PriceFormatted</div>
		</div>
	
		@if (product.ProductFields != null) {
			if (product.ProductFields.Count > 0) {
				<table class="table text-left mb-4">
					@foreach (var field in product.ProductFields) {
						string fieldValue = field.Value.Value.ToString();
						fieldValue = fieldValue == "False" ? Translate("No") : fieldValue;
						fieldValue = fieldValue == "True" ? Translate("Yes") : fieldValue;

						if (field.Value.Value.GetType() == typeof(System.Collections.Generic.List<FieldOptionValueViewModel>)) {
							fieldValue = "";

							foreach (FieldOptionValueViewModel option in field.Value.Value as System.Collections.Generic.List<FieldOptionValueViewModel>) {
								fieldValue = option.Value;
							}
						}

						bool isColor = false;
						if (fieldValue.Contains("#") && (Translate(field.Value.Name) == Translate("Color") || Translate(field.Value.Name) == Translate("Colour"))) {
							isColor = true;   
						}

						if (!string.IsNullOrEmpty(fieldValue)) {
							<tr>
								<td class="fw-light">@field.Value.Name</td>
								@if (!isColor) {
									<td class="fw-bold">@fieldValue</td>
								} else {
									<td>
										<div class="position-relative">
											<span class="colorbox-background" style="background-color: @fieldValue"></span>
										</div>
									</td>
								}
							</tr>
						}   
					}  
				</table>
			}
		}

		<div class="mb-4">
			@product.ShortDescription
		</div>
		<div class="mb-4">
			<form method="post" action="/Default.aspx?ID=@(GetPageIdByNavigationTag("CartService"))">
				<input type="hidden" name="redirect" value="false" />
				<input type="hidden" name="ProductId" value="@product.Id" />
				<input type="hidden" name="cartcmd" value="add" />

				<div class="input-group">
					<input id="Quantity_@product.Id" name="Quantity" value="1" type="hidden">
					<button type="button" onclick="Cart.UpdateCart(event)" class="btn btn-success rounded-0 text-uppercase p-3 w-100" title="@Translate("Add to cart")" id="AddToCartButton@(product.Id)">@Translate("Add to cart")</button>
				</div>
			</form>
		</div>
	</div>
</div>

